<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Haltes Musicales</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const Icons = {
      Calendar: ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      LogOut: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
      Plus: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      FileDown: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><polyline points="9 15 12 18 15 15"/></svg>,
      Lock: ({ size = 18 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
      Users: ({ size = 14 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Settings: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-4.84 4.84l-4.24 4.24M23 12h-6m-6 0H1m20.66 8.66l-4.24-4.24m-4.84-4.84l-4.24-4.24"/></svg>,
      Trash: ({ size = 18 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
    };

    const ADMIN_CODE = 'ADMIN2024';

    const DEFAULT_USERS = {
      professionnels: [],
      invites: []
    };

    const EVALUATION_STRUCTURE = {
      interactionsSociales: {
        title: "INTERACTIONS SOCIALES",
        items: [
          { key: "attitudeHabituelle", label: "Attitude habituelle", moments: [1,2,3,4], type: "invite", fieldType: "text" },
          { key: "interaction", label: "Interaction Sociale (échanges avec les personnes présentes)", moments: [1,2,3,4], type: "yellow" },
          { key: "reactionEmotionnelle", label: "Réaction émotionnelle", moments: [1,2,3,4], type: "yellow" },
          { key: "reactionSuiteHalte", label: "Réaction suite à la halte", moments: [1,2,3,4], type: "invite", fieldType: "text" }
        ]
      },
      stimulationSensorielle: {
        title: "STIMULATION MULTISENSORIELLE",
        items: [
          { key: "attitudeHabituelle", label: "Attitude habituelle", moments: [1,2,3,4], type: "invite", fieldType: "text" },
          { key: "reactionAuditive", label: "Réaction auditive (réceptivité à la musique)", moments: [1,2,3,4], type: "yellow" },
          { key: "reactionVisuelle", label: "Réaction visuelle (réceptivité aux éléments visuels)", moments: [1,2,3,4], type: "yellow" },
          { key: "reactionKinesth", label: "Réaction kinesthésique (mouvement, danse)", moments: [1,2,3,4], type: "yellow" },
          { key: "reactionSuiteHalte", label: "Réaction suite à la halte", moments: [1,2,3,4], type: "invite", fieldType: "text" }
        ]
      },
      memoire: {
        title: "MÉMOIRE / SOUVENIRS",
        items: [
          { key: "attitudeHabituelle", label: "Attitude habituelle", moments: [1,2,3,4], type: "invite", fieldType: "text" },
          { key: "reactivationSouvenirs", label: "Réactivation et verbalisation de souvenirs", moments: [1,2,3,4], type: "yellow" },
          { key: "reconnaissanceMusique", label: "Reconnaissance de la musique", moments: [1,2,3,4], type: "yellow" },
          { key: "reactionEmotionnelle2", label: "Réaction émotionnelle", moments: [1,2,3,4], type: "yellow" },
          { key: "reactionSuiteHalte", label: "Réaction suite à la halte", moments: [1,2,3,4], type: "invite", fieldType: "text" }
        ]
      },
      comportements: {
        title: "COMPORTEMENTS",
        items: [
          { key: "ideesDelirantes", label: "Idées délirantes", moments: [1,2,3,4], type: "white" },
          { key: "hallucinations", label: "Hallucinations", moments: [1,2,3,4], type: "white" },
          { key: "agitation", label: "Agitation/Agressivité", moments: [1,2,3,4], type: "white" },
          { key: "depression", label: "Dépression/Dysphorie", moments: [1,2,3,4], type: "white" },
          { key: "anxiete", label: "Anxiété", moments: [1,2,3,4], type: "white" },
          { key: "euphorie", label: "Exaltation de l'humeur / Euphorie", moments: [1,2,3,4], type: "white" },
          { key: "apathie", label: "Apathie / Indifférence", moments: [1,2,3,4], type: "white" },
          { key: "desinhibition", label: "Désinhibition", moments: [1,2,3,4], type: "white" },
          { key: "irritabilite", label: "Irritabilité / Instabilité de l'humeur", moments: [1,2,3,4], type: "white" },
          { key: "moteurAberrant", label: "Comportement moteur aberrant", moments: [1,2,3,4], type: "white" }
        ]
      }
    };

    const MOMENT_LABELS = { 
      1: "Intervention 1", 
      2: "Intervention 2", 
      3: "Intervention 3", 
      4: "Intervention 4" 
    };

    function createEmptyEvaluation() {
      return {
        id: Date.now().toString() + Math.random(),
        beneficiaire: { nom: '', prenom: '', dateNaissance: '', sexe: 'Féminin' },
        pathologies: '', 
        souhaitsM
