<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Haltes Musicales</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" src="src/App.jsx"></script>
</body>
</html>
// src/App.jsx
const { useState, useEffect } = React;

// Icons (identiques à ton code original)
const Icons = {
  Calendar: ({ size = 24 }) => (/* ... */),
  LogOut: ({ size = 20 }) => (/* ... */),
  Plus: ({ size = 20 }) => (/* ... */),
  Lock: ({ size = 18 }) => (/* ... */),
  Users: ({ size = 14 }) => (/* ... */),
  Trash: ({ size = 18 }) => (/* ... */),
  FileDown: ({ size = 20 }) => (/* ... */),
};

// Import des utils
const { hashPassword } = window.HaltesUtils.auth;
const { exportToCSV, exportToPDF } = window.HaltesUtils.export;
const { loadUsers, saveUsers, loadInterventions, saveInterventions } = window.HaltesUtils.storage;

// Import des composants
const LoginForm = window.HaltesComponents.LoginForm;
const AdminPanel = window.HaltesComponents.AdminPanel;
const InterventionList = window.HaltesComponents.InterventionList;
const BeneficiaireForm = window.HaltesComponents.BeneficiaireForm;
const Notification = window.HaltesComponents.Notification;

// App principale
function HaltesMusicalesApp() {
  const [currentUser, setCurrentUser] = useState(null);
  const [users, setUsers] = useState({ professionnels: [], invites: [] });
  const [interventions, setInterventions] = useState({});
  const [notification, setNotification] = useState(null);
  const [isLoading, setIsLoading] = useState(true);
  const [loginData, setLoginData] = useState({ email: '', password: '' });
  const [loginError, setLoginError] = useState('');
  const [showSignup, setShowSignup] = useState(true);
  const [showAdminLogin, setShowAdminLogin] = useState(false);
  const [showAdminPanel, setShowAdminPanel] = useState(false);
  const [expandedIntervention, setExpandedIntervention] = useState(null);
  const [showAddModal, setShowAddModal] = useState(false);
  const [newIntervention, setNewIntervention] = useState({ date: '', time: '', lieu: '' });

  // Chargement initial
  useEffect(() => {
    setUsers(loadUsers());
    setIsLoading(false);
  }, []);

  // Connexion sécurisée
  const handleLogin = async () => {
    if (loginData.email === 'admin' && loginData.password === 'ADMIN2024') {
      setCurrentUser({ type: 'admin', name: 'Administrateur', id: 'admin' });
      setShowAdminPanel(true);
      return;
    }
    const allUsers = [...users.professionnels, ...users.invites];
    const user = allUsers.find(u => u.email === loginData.email);
    if (!user) {
      setLoginError('Email ou mot de passe incorrect');
      return;
    }
    const hashedInput = await hashPassword(loginData.password);
    if (hashedInput !== user.password) {
      setLoginError('Email ou mot de passe incorrect');
      return;
    }
    setCurrentUser(user);
    setInterventions(loadInterventions(user.id));
    showNotif(`Bienvenue ${user.name} !`);
  };

  // Inscription sécurisée
  const handleSignup = async (signupData) => {
    const hashedPassword = await hashPassword(signupData.password);
    const userToAdd = { ...signupData, password: hashedPassword, id: Date.now().toString() };
    const updatedUsers = { ...users };
    updatedUsers[signupData.type === 'professionnel' ? 'professionnels' : 'invites'].push(userToAdd);
    saveUsers(updatedUsers);
    setUsers(updatedUsers);
    setCurrentUser(userToAdd);
    showNotif('Compte créé avec succès !');
  };

  // Export CSV
  const handleExportCSV = () => {
    const data = Object.values(interventions).map(i => ({
      lieu: i.lieu,
      date: new Date(i.date).toLocaleDateString('fr-FR'),
      beneficiaires: i.beneficiaires?.length || 0,
    }));
    exportToCSV(data);
  };

  // Export PDF
  const handleExportPDF = (intervention) => {
    exportToPDF(intervention);
  };

  // Notification
  const showNotif = (msg, type = 'success') => {
    setNotification({ msg, type });
    setTimeout(() => setNotification(null), 3000);
  };

  // Render
  if (isLoading) return <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-purple-50 flex items-center justify-center">Chargement...</div>;
  if (!currentUser) return <LoginForm onLogin={handleLogin} onSignup={handleSignup} error={loginError} setShowSignup={setShowSignup} setShowAdminLogin={setShowAdminLogin} />;
  if (currentUser.type === 'admin' && showAdminPanel) return <AdminPanel users={users} setUsers={setUsers} setCurrentUser={setCurrentUser} />;
  return (
    <div className="min-h-screen bg-gray-50">
      <Notification notification={notification} />
      <header className="bg-white shadow-sm border-b sticky top-0 z-40">
        {/* Header identique à ton code */}
      </header>
      <div className="max-w-7xl mx-auto px-4 py-6">
        {!expandedIntervention ? (
          <InterventionList
            interventions={interventions}
            currentUser={currentUser}
            setExpandedIntervention={setExpandedIntervention}
            setShowAddModal={setShowAddModal}
            onExportCSV={handleExportCSV}
          />
        ) : (
          <BeneficiaireForm
            intervention={interventions[expandedIntervention]}
            setInterventions={setInterventions}
            currentUser={currentUser}
            setExpandedIntervention={setExpandedIntervention}
            onExportPDF={handleExportPDF}
          />
        )}
      </div>
      {showAddModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          {/* Modal identique à ton code */}
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<HaltesMusicalesApp />, document.getElementById('root'));
// src/utils/auth.js
async function hashPassword(password) {
  const encoder = new TextEncoder();
  const data = encoder.encode(password);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

window.HaltesUtils = window.HaltesUtils || {};
window.HaltesUtils.auth = { hashPassword };
// src/utils/export.js
function exportToCSV(data, filename = 'interventions.csv') {
  const csv = Papa.unparse(data);
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.setAttribute('download', filename);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function exportToPDF(intervention) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text(`Intervention: ${intervention.lieu}`, 10, 10);
  doc.text(`Date: ${new Date(intervention.date).toLocaleDateString('fr-FR')}`, 10, 20);
  doc.save(`intervention_${intervention.id}.pdf`);
}

window.HaltesUtils = window.HaltesUtils || {};
window.HaltesUtils.export = { exportToCSV, exportToPDF };
// src/utils/storage.js
function loadUsers() {
  const usersData = localStorage.getItem('haltes_users');
  return usersData ? JSON.parse(usersData) : { professionnels: [], invites: [] };
}

function saveUsers(users) {
  localStorage.setItem('haltes_users', JSON.stringify(users));
}

function loadInterventions(userId) {
  const data = localStorage.getItem(`interventions_${userId}`);
  return data ? JSON.parse(data) : {};
}

function saveInterventions(userId, interventions) {
  localStorage.setItem(`interventions_${userId}`, JSON.stringify(interventions));
}

window.HaltesUtils = window.HaltesUtils || {};
window.HaltesUtils.storage = { loadUsers, saveUsers, loadInterventions, saveInterventions };
// src/components/LoginForm.jsx
const { useState } = React;

function LoginForm({ onLogin, onSignup, error, setShowSignup, setShowAdminLogin }) {
  const [loginData, setLoginData] = useState({ email: '', password: '' });
  const [signupData, setSignupData] = useState({ name: '', email: '', password: '', type: 'professionnel', etablissement: '', rgpdConsent: false });
  const [showSignup, setShowSignupLocal] = useState(true);

  return (
    // UI identique à ton code original, mais avec appel à onLogin/onSignup
    <div>{/* ... */}</div>
  );
}

window.HaltesComponents = window.HaltesComponents || {};
window.HaltesComponents.LoginForm = LoginForm;
// src/components/InterventionList.jsx
const { useState } = React;

function InterventionList({ interventions, currentUser, setExpandedIntervention, setShowAddModal, onExportCSV }) {
  const interventionsList = Object.values(interventions).sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-gray-900">Mes Interventions ({interventionsList.length})</h2>
        {currentUser.type === 'professionnel' && (
          <div className="flex gap-3">
            <button onClick={onExportCSV} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
              <window.Icons.FileDown /> Exporter CSV
            </button>
            <button onClick={() => setShowAddModal(true)} className="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
              <window.Icons.Plus /> Nouvelle intervention
            </button>
          </div>
        )}
      </div>
      {/* Liste identique à ton code */}
    </div>
  );
}

window.HaltesComponents = window.HaltesComponents || {};
window.HaltesComponents.InterventionList = InterventionList;
// src/components/BeneficiaireForm.jsx
function BeneficiaireForm({ intervention, setInterventions, currentUser, setExpandedIntervention, onExportPDF }) {
  return (
    <div>
      <button onClick={() => setExpandedIntervention(null)} className="mb-4 text-purple-600 hover:text-purple-700 font-medium">← Retour</button>
      <div className="bg-white rounded-xl shadow p-6 mb-6">
        <div className="flex justify-between items-start mb-4">
          <div>
            <h2 className="text-2xl font-bold text-gray-900">{intervention.lieu}</h2>
            <p className="text-gray-600 mt-1">
              {new Date(intervention.date).toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} à {intervention.time}
            </p>
          </div>
          <button onClick={() => onExportPDF(intervention)} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2">
            <window.Icons.FileDown /> Exporter PDF
          </button>
        </div>
        {/* Détails des bénéficiaires */}
      </div>
    </div>
  );
}

window.HaltesComponents = window.HaltesComponents || {};
window.HaltesComponents.BeneficiaireForm = BeneficiaireForm;
// src/components/Notification.jsx
function Notification({ notification }) {
  if (!notification) return null;
  return (
    <div className={`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg ${notification.type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}`}>
      {notification.type === 'success' && <span>✓</span>}
      <span>{notification.msg}</span>
    </div>
  );
}

window.HaltesComponents = window.HaltesComponents || {};
window.HaltesComponents.Notification = Notification;
// src/components/AdminPanel.jsx
function AdminPanel({ users, setUsers, setCurrentUser }) {
  // UI identique à ton code original
  return <div>{/* ... */}</div>;
}

window.HaltesComponents = window.HaltesComponents || {};
window.HaltesComponents.AdminPanel = AdminPanel;
# Haltes Musicales

Outil professionnel de suivi des interventions musicales en EHPAD et établissements de santé.

## Fonctionnalités
- Gestion des utilisateurs (psychologues, établissements)
- Suivi des interventions et bénéficiaires
- Export CSV/PDF
- Stockage local sécurisé

## Installation
1. Cloner ce dépôt
2. Ouvrir `index.html` dans un navigateur (ou déployer sur Netlify/Vercel)

## Déploiement
- Pour une version en ligne : [Netlify Drop](https://app.netlify.com/drop)
- Pour un backend : contacter le développeur
